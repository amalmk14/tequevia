{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Account</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link href="{% static 'css/accounts.css' %}" rel="stylesheet">
</head>
<body>

{% include "navbar.html" %}

<div class="container">
  <div class="d-flex flex-md-row gap-4">

    <!-- Sidebar -->
    <div class="sidebar-box" style="width: 100%; max-width: 300px;">
      <div class="sidebar-header">
        <div class="avatar"></div>
        <div class="user-info">
          <small>Hello,</small>
          <strong>Amal Mk</strong>
        </div>
      </div>

      <div class="sidebar-section-title">ACCOUNT SETTINGS</div>
      <div class="sidebar-item"><i class="fa-solid fa-user"></i> Profile Information</div>
      <div class="sidebar-item"><i class="fa-solid fa-location-dot"></i> Manage Addresses</div>

      <div class="sidebar-section-title">MY STUFF</div>
      <div class="sidebar-item"><i class="fa-solid fa-heart"></i> Wishlist</div>
      <div class="sidebar-item"><i class="fa-solid fa-cart-shopping"></i> Cart</div>
      <div class="sidebar-item"><i class="fa-solid fa-bag-shopping"></i> Orders</div>

      <div class="sidebar-section-title">OTHER</div>
      <div class="sidebar-item"><i class="fa-solid fa-gear"></i> Settings</div>
      <div class="sidebar-item"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</div>
    </div>

    <!-- Edit Profile Card -->
    <div class="pi-edit-card flex-grow-1">
      <h4>Edit Profile</h4>
      <form>
        <!-- Full Name -->
        <div class="mb-3 d-flex align-items-start justify-content-between flex-wrap">
          <div class="w-50 pe-3">
            <label for="name" class="form-label pi-form-label d-flex justify-content-between align-items-center">
              <span>Full Name</span>
              <button type="button" class="btn pi-toggle-edit" data-target="#name">Edit</button>
            </label>
            <div class="input-wrapper">
            <input type="text" class="form-control" id="name" value="Amal Mk" readonly />
            </div>
          </div>
          <div class="mt-4">
            <button type="button" class="btn btn-save btn-sm save-btn" data-target="#name" style="display: none;">Save</button>
          </div>
        </div>

        <!-- Email -->
        <div class="mb-3 d-flex align-items-start justify-content-between flex-wrap">
          <div class="w-50 pe-3">
            <label for="email" class="form-label pi-form-label d-flex justify-content-between align-items-center">
              <span>Email Address</span>
              <button type="button" class="btn pi-toggle-edit" data-target="#email">Edit</button>
            </label>
            <div class="input-wrapper">
            <input type="email" class="form-control" id="email" value="amal@example.com" readonly />
            </div>
          </div>
          <div class="mt-4">
            <button type="button" class="btn btn-save btn-sm save-btn" data-target="#email" style="display: none;">Save</button>
          </div>
        </div>

        <!-- Phone -->
        <div class="mb-3 d-flex align-items-start justify-content-between flex-wrap">
          <div class="w-50 pe-3">
            <label for="phone" class="form-label pi-form-label d-flex justify-content-between align-items-center">
              <span>Phone Number</span>
              <button type="button" class="btn pi-toggle-edit" data-target="#phone">Edit</button>
            </label>
            <div class="input-wrapper">
            <input type="tel" class="form-control pi-form-control" id="phone" value="+91 9876543210" readonly />
            </div>
          </div>
          <div class="mt-4">
            <button type="button" class="btn btn-save btn-sm save-btn" data-target="#phone" style="display: none;">Save</button>
          </div>
        </div>
      </form>
    </div>

  </div>
</div>

{% include "footer.html" %}
<script>
  const originalValues = {};

  document.querySelectorAll('.pi-toggle-edit').forEach(btn => {
    btn.addEventListener('click', function () {
      const inputId = this.dataset.target;
      const input = document.querySelector(inputId);
      const saveBtn = document.querySelector('.save-btn[data-target="' + inputId + '"]');
      const isEditMode = this.textContent === 'Edit';

      // If switching to edit mode
      if (isEditMode) {
        // Cancel all others first
        document.querySelectorAll('.pi-toggle-edit').forEach(b => {
          const otherInputId = b.dataset.target;
          const otherInput = document.querySelector(otherInputId);
          const otherSaveBtn = document.querySelector('.save-btn[data-target="' + otherInputId + '"]');

          if (b !== this && b.textContent === 'Cancel') {
            otherInput.setAttribute('readonly', true);
            otherInput.value = originalValues[otherInputId] ?? otherInput.value;
            b.textContent = 'Edit';
            otherSaveBtn.style.display = 'none';
          }
        });

        // Store original value only if not already stored
        if (!(inputId in originalValues)) {
          originalValues[inputId] = input.value;
        }

        input.removeAttribute('readonly');
        saveBtn.style.display = 'inline-block';
        this.textContent = 'Cancel';
      } else {
        // Cancel edit and restore original
        input.value = originalValues[inputId];
        input.setAttribute('readonly', true);
        saveBtn.style.display = 'none';
        this.textContent = 'Edit';
      }
    });
  });

  document.querySelectorAll('.save-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      const inputId = this.dataset.target;
      const input = document.querySelector(inputId);
      const toggleBtn = document.querySelector('.pi-toggle-edit[data-target="' + inputId + '"]');

      // Save value
      originalValues[inputId] = input.value;

      input.setAttribute('readonly', true);
      this.style.display = 'none';
      toggleBtn.textContent = 'Edit';

      // Optional: AJAX call to save to server here
    });
  });
</script>


</body>
</html>
